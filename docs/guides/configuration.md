# Configuration Guide

Learn how to configure Atomic EHR Codegen for your project's needs.

## Configuration Files

Atomic EHR Codegen supports multiple configuration file formats and locations.

### Supported File Names

The tool automatically searches for configuration files in this order:

1. `.atomic-codegen.json`
2. `.atomic-codegen.js`
3. `atomic-codegen.config.json`
4. `atomic-codegen.config.js`

### File Formats

#### JSON Configuration

```json
{
  "$schema": "https://atomic-ehr.github.io/codegen/config-schema.json",
  "version": "1.0.0",
  "project": {
    "name": "my-fhir-project",
    "description": "FHIR types for my healthcare application"
  },
  "typeschema": {
    "packages": [
      "hl7.fhir.r4.core@4.0.1",
      "hl7.fhir.us.core@6.1.0"
    ],
    "outputFormat": "ndjson",
    "validation": true,
    "treeshaking": ["Patient", "Observation", "Encounter"]
  },
  "generator": {
    "target": "typescript",
    "outputDir": "./src/types/fhir",
    "includeComments": true,
    "includeValidation": false,
    "namespaceStyle": "nested",
    "fileNaming": "PascalCase",
    "format": true,
    "generateProfiles": true
  },
  "languages": {
    "typescript": {
      "strict": true,
      "target": "ES2020",
      "module": "ES2020",
      "declaration": true,
      "useEnums": true,
      "preferInterfaces": true
    }
  }
}
```

#### JavaScript Configuration

```javascript
/**
 * @type {import('@atomic-ehr/codegen').ConfigFileSchema}
 */
module.exports = {
  version: "1.0.0",
  typeschema: {
    packages: [
      "hl7.fhir.r4.core@4.0.1",
      "hl7.fhir.us.core@6.1.0"
    ],
    outputFormat: "ndjson",
    validation: true
  },
  generator: {
    target: "typescript",
    outputDir: "./src/types/fhir",
    includeComments: true,
    namespaceStyle: "nested"
  }
};
```

## Configuration Sections

### Project Configuration

```json
{
  "project": {
    "name": "my-healthcare-app",
    "version": "1.0.0",
    "description": "FHIR types for healthcare application",
    "rootDir": ".",
    "workingDir": "tmp/atomic-codegen"
  }
}
```

| Option | Type | Description |
|--------|------|-------------|
| `name` | string | Project name |
| `version` | string | Project version |
| `description` | string | Project description |
| `rootDir` | string | Root directory for relative paths |
| `workingDir` | string | Working directory for temporary files |

### TypeSchema Configuration

```json
{
  "typeschema": {
    "packages": [
      "hl7.fhir.r4.core@4.0.1",
      "hl7.fhir.us.core@6.1.0"
    ],
    "outputFormat": "ndjson",
    "validation": true,
    "treeshaking": ["Patient", "Observation"],
    "workingDir": "tmp/packages",
    "dropCache": false,
    "verbose": false
  }
}
```

| Option | Type | Description |
|--------|------|-------------|
| `packages` | string[] | FHIR packages to process |
| `outputFormat` | "ndjson" \| "separate" \| "merged" | Output format |
| `validation` | boolean | Enable schema validation |
| `treeshaking` | string[] | Include only specified types |
| `workingDir` | string | Package cache directory |
| `dropCache` | boolean | Clear package cache |
| `verbose` | boolean | Enable verbose logging |

### Generator Configuration

```json
{
  "generator": {
    "target": "typescript",
    "outputDir": "./src/types",
    "includeComments": true,
    "includeValidation": false,
    "namespaceStyle": "nested",
    "fileNaming": "PascalCase",
    "format": true,
    "fileHeader": "Generated by atomic-codegen",
    "overwrite": true,
    "generateProfiles": true
  }
}
```

| Option | Type | Description |
|--------|------|-------------|
| `target` | "typescript" \| "python" | Target language |
| `outputDir` | string | Output directory |
| `includeComments` | boolean | Include JSDoc comments |
| `includeValidation` | boolean | Include validation code |
| `namespaceStyle` | "nested" \| "flat" | Namespace organization |
| `fileNaming` | "camelCase" \| "kebab-case" \| "snake_case" \| "PascalCase" | File naming convention |
| `format` | boolean | Format generated code |
| `fileHeader` | string | Custom header for generated files |
| `overwrite` | boolean | Overwrite existing files |
| `generateProfiles` | boolean | Generate profile types |

### Language-Specific Configuration

#### TypeScript Configuration

```json
{
  "languages": {
    "typescript": {
      "strict": true,
      "target": "ES2020",
      "module": "ES2020",
      "declaration": true,
      "baseTypesModule": "@types/fhir",
      "useEnums": true,
      "preferInterfaces": true
    }
  }
}
```

| Option | Type | Description |
|--------|------|-------------|
| `strict` | boolean | Enable strict mode |
| `target` | string | TypeScript target version |
| `module` | string | Module system |
| `declaration` | boolean | Generate .d.ts files |
| `baseTypesModule` | string | Import path for base types |
| `useEnums` | boolean | Use enums for value sets |
| `preferInterfaces` | boolean | Prefer interfaces over types |

#### Python Configuration

```json
{
  "languages": {
    "python": {
      "version": "3.11",
      "packageManager": "pip",
      "typeHints": true,
      "usePydantic": true,
      "importStyle": "absolute",
      "generateInit": true,
      "typeChecking": true,
      "strictOptional": true
    }
  }
}
```

| Option | Type | Description |
|--------|------|-------------|
| `version` | string | Python version target |
| `packageManager` | "pip" \| "poetry" \| "pipenv" | Package manager |
| `typeHints` | boolean | Include type hints |
| `usePydantic` | boolean | Generate Pydantic models |
| `importStyle` | "absolute" \| "relative" | Import style |
| `generateInit` | boolean | Generate __init__.py files |
| `typeChecking` | boolean | Include TYPE_CHECKING imports |
| `strictOptional` | boolean | Use strict optional typing |

## Configuration Management

### Initialize Configuration

```bash
# Create basic configuration
atomic-codegen config init

# Use a template
atomic-codegen config init --template typescript
atomic-codegen config init --template python
atomic-codegen config init --template multi-lang

# Specify output file
atomic-codegen config init --output my-config.json

# Force overwrite existing config
atomic-codegen config init --force
```

### Validate Configuration

```bash
# Validate current configuration
atomic-codegen config validate

# Validate specific file
atomic-codegen config validate --config my-config.json

# Show validation details
atomic-codegen config validate --verbose
```

### Show Configuration

```bash
# Show current configuration
atomic-codegen config show

# Show configuration sources
atomic-codegen config show --show-sources

# Show specific file
atomic-codegen config show --config my-config.json
```

## Environment Variables

Override configuration with environment variables:

```bash
# Global settings
export ATOMIC_CODEGEN_VERBOSE=true
export ATOMIC_CODEGEN_OUTPUT_DIR=./types
export ATOMIC_CODEGEN_LOG_LEVEL=debug

# TypeSchema settings
export ATOMIC_CODEGEN_TYPESCHEMA_FORMAT=ndjson
export ATOMIC_CODEGEN_TYPESCHEMA_VALIDATION=true

# Generator settings
export ATOMIC_CODEGEN_GENERATOR_TARGET=typescript
export ATOMIC_CODEGEN_INCLUDE_COMMENTS=true
export ATOMIC_CODEGEN_NAMESPACE_STYLE=nested

# TypeScript settings
export ATOMIC_CODEGEN_TS_STRICT=true
export ATOMIC_CODEGEN_TS_TARGET=ES2020
```

## Configuration Precedence

Configuration is resolved in this order (highest to lowest priority):

1. **CLI Arguments**: `--output ./types`
2. **Environment Variables**: `ATOMIC_CODEGEN_OUTPUT_DIR=./types`
3. **Configuration File**: `.atomic-codegen.json`
4. **Default Values**: Built-in defaults

## Templates

### Available Templates

| Template | Description | Best For |
|----------|-------------|----------|
| `minimal` | Basic configuration | Simple projects |
| `typescript` | TypeScript-focused setup | Frontend/Node.js apps |
| `python` | Python-focused setup | Python/Django/FastAPI |
| `multi-lang` | Multi-language setup | Full-stack projects |
| `full` | Complete configuration | Complex projects |

### Custom Templates

Create your own template file and reference it:

```bash
# Create from custom template
atomic-codegen config init --template ./my-template.json
```

## Advanced Configuration

### Conditional Configuration

Use JavaScript configuration for dynamic settings:

```javascript
const isDevelopment = process.env.NODE_ENV === 'development';

module.exports = {
  typeschema: {
    packages: isDevelopment 
      ? ['hl7.fhir.r4.core@4.0.1'] 
      : ['hl7.fhir.r4.core@4.0.1', 'hl7.fhir.us.core@6.1.0'],
    validation: !isDevelopment
  },
  generator: {
    outputDir: isDevelopment ? './dev-types' : './types',
    includeComments: isDevelopment,
    format: !isDevelopment
  }
};
```

### Multiple Configurations

Use different configurations for different environments:

```bash
# Development
atomic-codegen --config .atomic-codegen.dev.json typeschema create

# Production
atomic-codegen --config .atomic-codegen.prod.json typeschema create

# Testing
atomic-codegen --config .atomic-codegen.test.json typeschema create
```

### Workspace Configuration

For monorepos, use per-package configurations:

```
my-monorepo/
├── .atomic-codegen.json          # Root configuration
├── packages/
│   ├── frontend/
│   │   └── .atomic-codegen.json  # Frontend-specific config
│   └── backend/
│       └── .atomic-codegen.json  # Backend-specific config
```

## Best Practices

### 1. Use Configuration Files

Always use configuration files for consistent builds:

```json
{
  "typeschema": {
    "packages": ["hl7.fhir.r4.core@4.0.1"],
    "validation": true
  },
  "generator": {
    "outputDir": "./src/types",
    "format": true
  }
}
```

### 2. Version Your Configuration

Include configuration files in version control:

```gitignore
# Don't ignore configuration files
# .atomic-codegen.json
```

### 3. Environment-Specific Overrides

Use environment variables for deployment-specific settings:

```bash
# CI/CD pipeline
export ATOMIC_CODEGEN_OUTPUT_DIR=/dist/types
export ATOMIC_CODEGEN_VERBOSE=false
```

### 4. Document Your Configuration

Add comments to explain non-obvious settings:

```javascript
module.exports = {
  typeschema: {
    // Use specific version for reproducible builds
    packages: ["hl7.fhir.r4.core@4.0.1"],
    // Only include resources we actually use
    treeshaking: ["Patient", "Observation", "Encounter"]
  },
  generator: {
    // Generate to source directory for hot reload
    outputDir: "./src/types/fhir",
    // Include comments for better DX
    includeComments: true
  }
};
```

## Troubleshooting

### Configuration Not Found

If the tool can't find your configuration:

1. Check the file name matches supported formats
2. Ensure the file is in the current working directory
3. Use `--config` flag to specify the path explicitly

### Validation Errors

If configuration validation fails:

1. Check the JSON syntax is valid
2. Ensure all required fields are present
3. Verify field types match the schema
4. Use `atomic-codegen config validate --verbose` for details

### Schema Validation

Enable JSON schema validation in your editor:

```json
{
  "$schema": "https://atomic-ehr.github.io/codegen/config-schema.json"
}
```

This provides autocompletion and validation in VS Code and other editors.